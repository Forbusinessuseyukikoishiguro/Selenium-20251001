# åº§æ¨™æŒ‡å®šã§ã®ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°å®Œå…¨ã‚¬ã‚¤ãƒ‰ ğŸ¯

XPathã‚„CSSã‚»ãƒ¬ã‚¯ã‚¿ãŒä½¿ãˆãªã„æ™‚ã®**åº§æ¨™ãƒ™ãƒ¼ã‚¹æ“ä½œ**ã‚’è©³ã—ãè§£èª¬ã—ã¾ã™ï¼

---

## ğŸ“ ãªãœåº§æ¨™æŒ‡å®šãŒå¿…è¦ï¼Ÿ

### ã‚ˆãã‚ã‚‹ã‚±ãƒ¼ã‚¹
- Canvasè¦ç´ å†…ã®æç”»ã‚³ãƒ³ãƒ†ãƒ³ãƒ„
- Shadow DOMã§éš è”½ã•ã‚ŒãŸè¦ç´ 
- å‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹è­˜åˆ¥å­ãªã—è¦ç´ 
- ç”»åƒèªè­˜å¾Œã®ã‚¯ãƒªãƒƒã‚¯æ“ä½œ
- ã‚²ãƒ¼ãƒ ã‚„ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„

---

## ğŸ¯ æ–¹æ³•1: JavaScriptåº§æ¨™å–å¾— + Seleniumæ“ä½œ

### åŸºæœ¬çš„ãªåº§æ¨™å–å¾—

```python
from selenium import webdriver
from selenium.webdriver.common.action_chains import ActionChains
from selenium.webdriver.common.by import By
import time

driver = webdriver.Chrome()
driver.get("https://example.com")

# ===== è¦ç´ ã®åº§æ¨™ã‚’å–å¾— =====
element = driver.find_element(By.CSS_SELECTOR, ".target-element")

# æ–¹æ³•1: location ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ï¼ˆãƒšãƒ¼ã‚¸å…¨ä½“ã§ã®ä½ç½®ï¼‰
location = element.location
x = location['x']
y = location['y']
print(f"è¦ç´ ã®ä½ç½®: X={x}, Y={y}")

# æ–¹æ³•2: location_once_scrolled_into_viewï¼ˆã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«è¾¼ã¿ï¼‰
location_scrolled = element.location_once_scrolled_into_view
x_scroll = location_scrolled['x']
y_scroll = location_scrolled['y']

# æ–¹æ³•3: JavaScriptã§æ­£ç¢ºãªåº§æ¨™ã‚’å–å¾—
js_location = driver.execute_script("""
    var element = arguments[0];
    var rect = element.getBoundingClientRect();
    return {
        x: rect.left + window.pageXOffset,
        y: rect.top + window.pageYOffset,
        width: rect.width,
        height: rect.height,
        centerX: rect.left + window.pageXOffset + rect.width/2,
        centerY: rect.top + window.pageYOffset + rect.height/2
    };
""", element)

print(f"è©³ç´°åº§æ¨™: {js_location}")
print(f"ä¸­å¿ƒåº§æ¨™: ({js_location['centerX']}, {js_location['centerY']})")
```

---

## ğŸ–±ï¸ æ–¹æ³•2: ActionChainsã§åº§æ¨™ã‚¯ãƒªãƒƒã‚¯

### åŸºæœ¬çš„ãªã‚¯ãƒªãƒƒã‚¯æ“ä½œ

```python
from selenium.webdriver.common.action_chains import ActionChains

# ===== 1. çµ¶å¯¾åº§æ¨™ã§ã‚¯ãƒªãƒƒã‚¯ï¼ˆãƒšãƒ¼ã‚¸å·¦ä¸Šã‹ã‚‰ã®è·é›¢ï¼‰ =====
actions = ActionChains(driver)

# (100, 200)ã®ä½ç½®ã‚’ã‚¯ãƒªãƒƒã‚¯
actions.move_by_offset(100, 200).click().perform()

# âš ï¸ æ³¨æ„: move_by_offsetã¯ç´¯ç©ã™ã‚‹ãŸã‚ã€ãƒªã‚»ãƒƒãƒˆãŒå¿…è¦
actions.reset_actions()


# ===== 2. è¦ç´ ã‹ã‚‰ã®ç›¸å¯¾åº§æ¨™ã§ã‚¯ãƒªãƒƒã‚¯ =====
element = driver.find_element(By.ID, "base-element")

# è¦ç´ ã®å·¦ä¸Šã‚’åŸºæº–ã«ã€å³ã«50pxã€ä¸‹ã«30pxã®ä½ç½®ã‚’ã‚¯ãƒªãƒƒã‚¯
actions.move_to_element_with_offset(element, 50, 30).click().perform()


# ===== 3. è¦ç´ ã®ä¸­å¿ƒã‚’ã‚¯ãƒªãƒƒã‚¯ =====
actions.move_to_element(element).click().perform()


# ===== 4. ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆåº§æ¨™ã§ã‚¯ãƒªãƒƒã‚¯ï¼ˆJavaScriptã§å®Ÿè¡Œï¼‰ =====
# ãƒ–ãƒ©ã‚¦ã‚¶ã®è¡¨ç¤ºé ˜åŸŸå†…ã®åº§æ¨™ (x, y) ã§ã‚¯ãƒªãƒƒã‚¯
driver.execute_script("""
    var x = arguments[0];
    var y = arguments[1];
    var element = document.elementFromPoint(x, y);
    if (element) {
        element.click();
    }
""", 150, 200)
```

### å®Ÿè·µä¾‹ï¼šCanvasè¦ç´ å†…ã®ç‰¹å®šä½ç½®ã‚’ã‚¯ãƒªãƒƒã‚¯

```python
# ===== Canvasè¦ç´ å†…ã®åº§æ¨™ã‚¯ãƒªãƒƒã‚¯ =====
canvas = driver.find_element(By.ID, "game-canvas")

# Canvaså†…ã®ç›¸å¯¾åº§æ¨™ (100, 150) ã‚’ã‚¯ãƒªãƒƒã‚¯
actions = ActionChains(driver)
actions.move_to_element_with_offset(canvas, 100, 150).click().perform()
actions.reset_actions()

# è¤‡æ•°ç®‡æ‰€ã‚’é€£ç¶šã‚¯ãƒªãƒƒã‚¯
click_positions = [
    (50, 50),
    (150, 100),
    (200, 200),
    (300, 150)
]

for x, y in click_positions:
    actions = ActionChains(driver)
    actions.move_to_element_with_offset(canvas, x, y).click().perform()
    actions.reset_actions()
    time.sleep(0.5)  # ã‚¯ãƒªãƒƒã‚¯é–“éš”
```

---

## ğŸ® æ–¹æ³•3: PyAutoGUIã§ç›´æ¥åº§æ¨™æ“ä½œ

### ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
```bash
pip install pyautogui
```

### åŸºæœ¬çš„ãªä½¿ã„æ–¹

```python
import pyautogui
from selenium import webdriver
import time

driver = webdriver.Chrome()
driver.get("https://example.com")
driver.maximize_window()

# ===== 1. ç”»é¢ä¸Šã®çµ¶å¯¾åº§æ¨™ã§ã‚¯ãƒªãƒƒã‚¯ =====
# ãƒ–ãƒ©ã‚¦ã‚¶ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®ä½ç½®ã‚’è€ƒæ…®ã™ã‚‹å¿…è¦ã‚ã‚Š
pyautogui.click(500, 300)

# ===== 2. Seleniumè¦ç´ ã®åº§æ¨™ã‚’å–å¾—ã—ã¦PyAutoGUIã§ã‚¯ãƒªãƒƒã‚¯ =====
element = driver.find_element(By.ID, "target-button")

# è¦ç´ ã®ä½ç½®ã¨ã‚µã‚¤ã‚ºã‚’å–å¾—
location = element.location
size = element.size

# ãƒ–ãƒ©ã‚¦ã‚¶ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®ä½ç½®ã‚’å–å¾—
window_position = driver.get_window_position()
window_x = window_position['x']
window_y = window_position['y']

# å®Ÿéš›ã®ç”»é¢åº§æ¨™ã‚’è¨ˆç®—ï¼ˆè¦ç´ ã®ä¸­å¿ƒï¼‰
screen_x = window_x + location['x'] + size['width'] / 2
screen_y = window_y + location['y'] + size['height'] / 2 + 80  # ãƒ–ãƒ©ã‚¦ã‚¶ãƒ˜ãƒƒãƒ€ãƒ¼åˆ†ã‚’åŠ ç®—

# ã‚¯ãƒªãƒƒã‚¯å®Ÿè¡Œ
pyautogui.click(screen_x, screen_y)

# ===== 3. ãƒã‚¦ã‚¹ç§»å‹•ã¨ã‚¯ãƒªãƒƒã‚¯ã‚’åˆ†é›¢ =====
pyautogui.moveTo(screen_x, screen_y, duration=0.5)  # 0.5ç§’ã‹ã‘ã¦ç§»å‹•
time.sleep(0.2)
pyautogui.click()

# ===== 4. ãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯ =====
pyautogui.doubleClick(screen_x, screen_y)

# ===== 5. å³ã‚¯ãƒªãƒƒã‚¯ =====
pyautogui.rightClick(screen_x, screen_y)

# ===== 6. ãƒ‰ãƒ©ãƒƒã‚°æ“ä½œ =====
# (100, 200)ã‹ã‚‰(300, 400)ã¸ãƒ‰ãƒ©ãƒƒã‚°
pyautogui.moveTo(100, 200)
pyautogui.mouseDown()
pyautogui.moveTo(300, 400, duration=1)
pyautogui.mouseUp()

# ã¾ãŸã¯
pyautogui.drag(200, 200, duration=1)  # ç¾åœ¨ä½ç½®ã‹ã‚‰ç›¸å¯¾çš„ã«ç§»å‹•
```

### å®Ÿè·µä¾‹ï¼šåº§æ¨™ãƒ™ãƒ¼ã‚¹ã®ãƒ•ã‚©ãƒ¼ãƒ å…¥åŠ›

```python
# ===== åº§æ¨™æŒ‡å®šã§ãƒ•ã‚©ãƒ¼ãƒ ã‚’å…¥åŠ› =====
# å„å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®åº§æ¨™ã‚’äº‹å‰ã«æŠŠæ¡ã—ã¦ãŠã
form_fields = {
    'name': (300, 200),
    'email': (300, 250),
    'phone': (300, 300),
    'submit': (350, 400)
}

# åå‰ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦å…¥åŠ›
pyautogui.click(form_fields['name'])
time.sleep(0.3)
pyautogui.write('Taro Yamada', interval=0.1)

# ãƒ¡ãƒ¼ãƒ«ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
pyautogui.click(form_fields['email'])
time.sleep(0.3)
pyautogui.write('taro@example.com', interval=0.1)

# é›»è©±ç•ªå·ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
pyautogui.click(form_fields['phone'])
time.sleep(0.3)
pyautogui.write('090-1234-5678', interval=0.1)

# é€ä¿¡ãƒœã‚¿ãƒ³
pyautogui.click(form_fields['submit'])
```

---

## ğŸ¨ æ–¹æ³•4: ç”»åƒèªè­˜ + åº§æ¨™ã‚¯ãƒªãƒƒã‚¯

### PyAutoGUIã®ç”»åƒèªè­˜æ©Ÿèƒ½

```python
import pyautogui

# ===== 1. ç”»é¢ä¸Šã®ç”»åƒã‚’æ¤œç´¢ã—ã¦ã‚¯ãƒªãƒƒã‚¯ =====
# äº‹å‰ã«ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’ä¿å­˜ã—ã¦ãŠã
# button.png: ã‚¯ãƒªãƒƒã‚¯ã—ãŸã„ãƒœã‚¿ãƒ³ã®ç”»åƒ

try:
    # ç”»åƒã‚’æ¢ã—ã¦ä½ç½®ã‚’å–å¾—
    button_location = pyautogui.locateOnScreen('button.png', confidence=0.9)
    
    if button_location:
        # ç”»åƒã®ä¸­å¿ƒåº§æ¨™ã‚’å–å¾—
        button_center = pyautogui.center(button_location)
        
        print(f"ãƒœã‚¿ãƒ³ç™ºè¦‹: {button_location}")
        print(f"ä¸­å¿ƒåº§æ¨™: {button_center}")
        
        # ã‚¯ãƒªãƒƒã‚¯å®Ÿè¡Œ
        pyautogui.click(button_center)
    else:
        print("ãƒœã‚¿ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ")
        
except pyautogui.ImageNotFoundException:
    print("ç”»åƒãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ")


# ===== 2. å…¨ã¦ã®ä¸€è‡´ã™ã‚‹ç”»åƒã‚’å–å¾— =====
all_buttons = list(pyautogui.locateAllOnScreen('icon.png', confidence=0.8))
print(f"{len(all_buttons)}å€‹ã®ã‚¢ã‚¤ã‚³ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ")

# å…¨ã¦ã‚’ã‚¯ãƒªãƒƒã‚¯
for button in all_buttons:
    center = pyautogui.center(button)
    pyautogui.click(center)
    time.sleep(0.5)


# ===== 3. ç”»åƒãŒè¦‹ã¤ã‹ã‚‹ã¾ã§å¾…æ©Ÿ =====
def wait_and_click_image(image_path, timeout=10, confidence=0.9):
    """ç”»åƒãŒè¦‹ã¤ã‹ã‚‹ã¾ã§å¾…æ©Ÿã—ã¦ã‚¯ãƒªãƒƒã‚¯"""
    start_time = time.time()
    
    while time.time() - start_time < timeout:
        try:
            location = pyautogui.locateOnScreen(image_path, confidence=confidence)
            if location:
                center = pyautogui.center(location)
                pyautogui.click(center)
                print(f"ç”»åƒç™ºè¦‹ï¼ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã—ãŸ: {center}")
                return True
        except:
            pass
        
        time.sleep(0.5)
    
    print(f"ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ: {timeout}ç§’ä»¥å†…ã«ç”»åƒãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ")
    return False

# ä½¿ç”¨ä¾‹
wait_and_click_image('login_button.png', timeout=15)
```

### OpenCV + Selenium ã§ç”»åƒèªè­˜

```python
import cv2
import numpy as np
from PIL import Image
import io

# ===== ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‹ã‚‰ç”»åƒã‚’æ¤œç´¢ =====
def find_image_on_page(driver, template_path, threshold=0.8):
    """
    ãƒšãƒ¼ã‚¸ä¸Šã§ç”»åƒã‚’æ¤œç´¢ã—ã¦åº§æ¨™ã‚’è¿”ã™
    
    Args:
        driver: Seleniumãƒ‰ãƒ©ã‚¤ãƒãƒ¼
        template_path: æ¤œç´¢ã—ãŸã„ç”»åƒã®ãƒ‘ã‚¹
        threshold: ä¸€è‡´åº¦ã®é–¾å€¤ï¼ˆ0-1ï¼‰
    
    Returns:
        list: [(x, y, width, height), ...] ãƒãƒƒãƒã—ãŸé ˜åŸŸã®ãƒªã‚¹ãƒˆ
    """
    # ãƒšãƒ¼ã‚¸å…¨ä½“ã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ
    screenshot = driver.get_screenshot_as_png()
    screenshot_img = Image.open(io.BytesIO(screenshot))
    screenshot_np = np.array(screenshot_img)
    screenshot_gray = cv2.cvtColor(screenshot_np, cv2.COLOR_RGB2GRAY)
    
    # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç”»åƒã‚’èª­ã¿è¾¼ã¿
    template = cv2.imread(template_path, cv2.IMREAD_GRAYSCALE)
    w, h = template.shape[::-1]
    
    # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒãƒƒãƒãƒ³ã‚°
    result = cv2.matchTemplate(screenshot_gray, template, cv2.TM_CCOEFF_NORMED)
    
    # é–¾å€¤ä»¥ä¸Šã®ä¸€è‡´ç®‡æ‰€ã‚’å–å¾—
    locations = np.where(result >= threshold)
    
    matches = []
    for pt in zip(*locations[::-1]):
        matches.append({
            'x': int(pt[0]),
            'y': int(pt[1]),
            'width': w,
            'height': h,
            'center_x': int(pt[0] + w/2),
            'center_y': int(pt[1] + h/2),
            'confidence': float(result[pt[1], pt[0]])
        })
    
    return matches


# ===== ä½¿ç”¨ä¾‹ =====
driver = webdriver.Chrome()
driver.get("https://example.com")
time.sleep(2)

# ã€Œè³¼å…¥ãƒœã‚¿ãƒ³ã€ã®ç”»åƒã‚’æ¤œç´¢
matches = find_image_on_page(driver, 'buy_button.png', threshold=0.85)

if matches:
    print(f"{len(matches)}å€‹ã®ãƒœã‚¿ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ")
    
    # æœ€ã‚‚ä¸€è‡´åº¦ã®é«˜ã„ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
    best_match = max(matches, key=lambda x: x['confidence'])
    
    print(f"æœ€è‰¯ãƒãƒƒãƒ: {best_match}")
    
    # JavaScriptã§åº§æ¨™ã‚¯ãƒªãƒƒã‚¯
    driver.execute_script("""
        var x = arguments[0];
        var y = arguments[1];
        var element = document.elementFromPoint(x, y);
        if (element) {
            element.click();
        }
    """, best_match['center_x'], best_match['center_y'])
else:
    print("ãƒœã‚¿ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ")
```

---

## ğŸ“ æ–¹æ³•5: ç›¸å¯¾åº§æ¨™è¨ˆç®—

### åŸºæº–è¦ç´ ã‹ã‚‰ã®ç›¸å¯¾ä½ç½®ã§æ“ä½œ

```python
# ===== åŸºæº–è¦ç´ ã‚’è¦‹ã¤ã‘ã¦ã€ãã“ã‹ã‚‰ã®ç›¸å¯¾åº§æ¨™ã§æ“ä½œ =====

# ä¾‹ï¼šãƒšãƒ¼ã‚¸ä¸Šéƒ¨ã®ãƒ­ã‚´ã‹ã‚‰å³ã«300pxã€ä¸‹ã«100pxã®ä½ç½®ã‚’ã‚¯ãƒªãƒƒã‚¯

# åŸºæº–è¦ç´ ã‚’å–å¾—
logo = driver.find_element(By.CLASS_NAME, "site-logo")
logo_location = logo.location
logo_size = logo.size

# ç›¸å¯¾åº§æ¨™ã‚’è¨ˆç®—
target_x = logo_location['x'] + 300
target_y = logo_location['y'] + 100

# JavaScriptã§ã‚¯ãƒªãƒƒã‚¯
driver.execute_script(f"""
    var element = document.elementFromPoint({target_x}, {target_y});
    if (element) {{
        element.click();
    }}
""")


# ===== è¤‡æ•°ã®åŸºæº–ç‚¹ã‹ã‚‰ã®ç›¸å¯¾è¨ˆç®— =====
def click_relative_to_element(driver, base_element, offset_x, offset_y):
    """
    åŸºæº–è¦ç´ ã‹ã‚‰ã®ç›¸å¯¾åº§æ¨™ã§ã‚¯ãƒªãƒƒã‚¯
    
    Args:
        driver: Seleniumãƒ‰ãƒ©ã‚¤ãƒãƒ¼
        base_element: åŸºæº–ã¨ãªã‚‹è¦ç´ 
        offset_x: Xæ–¹å‘ã®ã‚ªãƒ•ã‚»ãƒƒãƒˆï¼ˆå³ãŒæ­£ï¼‰
        offset_y: Yæ–¹å‘ã®ã‚ªãƒ•ã‚»ãƒƒãƒˆï¼ˆä¸‹ãŒæ­£ï¼‰
    """
    # åŸºæº–è¦ç´ ã®ä¸­å¿ƒåº§æ¨™ã‚’å–å¾—
    location = driver.execute_script("""
        var element = arguments[0];
        var rect = element.getBoundingClientRect();
        return {
            centerX: rect.left + rect.width/2,
            centerY: rect.top + rect.height/2
        };
    """, base_element)
    
    # ã‚¿ãƒ¼ã‚²ãƒƒãƒˆåº§æ¨™ã‚’è¨ˆç®—
    target_x = location['centerX'] + offset_x
    target_y = location['centerY'] + offset_y
    
    # ã‚¯ãƒªãƒƒã‚¯å®Ÿè¡Œ
    driver.execute_script("""
        var x = arguments[0];
        var y = arguments[1];
        var element = document.elementFromPoint(x, y);
        if (element) {
            element.click();
        }
    """, target_x, target_y)
    
    print(f"åº§æ¨™ ({target_x}, {target_y}) ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã—ãŸ")


# ä½¿ç”¨ä¾‹
header = driver.find_element(By.TAG_NAME, "header")
click_relative_to_element(driver, header, 200, 50)  # ãƒ˜ãƒƒãƒ€ãƒ¼ã‹ã‚‰å³200pxã€ä¸‹50px
```

---

## ğŸ¯ æ–¹æ³•6: ã‚°ãƒªãƒƒãƒ‰åº§æ¨™ã‚·ã‚¹ãƒ†ãƒ 

### ãƒšãƒ¼ã‚¸ã‚’ä»®æƒ³ã‚°ãƒªãƒƒãƒ‰ã«åˆ†å‰²ã—ã¦æ“ä½œ

```python
# ===== ãƒšãƒ¼ã‚¸ã‚’ã‚°ãƒªãƒƒãƒ‰ã«åˆ†å‰²ã—ã¦åº§æ¨™ç®¡ç† =====
class CoordinateGrid:
    def __init__(self, driver, grid_width=10, grid_height=10):
        """
        ãƒšãƒ¼ã‚¸ã‚’ã‚°ãƒªãƒƒãƒ‰ã«åˆ†å‰²
        
        Args:
            driver: Seleniumãƒ‰ãƒ©ã‚¤ãƒãƒ¼
            grid_width: ã‚°ãƒªãƒƒãƒ‰ã®æ¨ªåˆ†å‰²æ•°
            grid_height: ã‚°ãƒªãƒƒãƒ‰ã®ç¸¦åˆ†å‰²æ•°
        """
        self.driver = driver
        self.grid_width = grid_width
        self.grid_height = grid_height
        
        # ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆã®ã‚µã‚¤ã‚ºã‚’å–å¾—
        viewport_size = driver.execute_script("""
            return {
                width: window.innerWidth,
                height: window.innerHeight
            };
        """)
        
        self.viewport_width = viewport_size['width']
        self.viewport_height = viewport_size['height']
        
        # ã‚°ãƒªãƒƒãƒ‰1ãƒã‚¹ã®ã‚µã‚¤ã‚º
        self.cell_width = self.viewport_width / grid_width
        self.cell_height = self.viewport_height / grid_height
    
    def get_coordinates(self, grid_x, grid_y):
        """
        ã‚°ãƒªãƒƒãƒ‰åº§æ¨™ã‚’å®Ÿéš›ã®åº§æ¨™ã«å¤‰æ›
        
        Args:
            grid_x: ã‚°ãƒªãƒƒãƒ‰ã®Xåº§æ¨™ (0 ~ grid_width-1)
            grid_y: ã‚°ãƒªãƒƒãƒ‰ã®Yåº§æ¨™ (0 ~ grid_height-1)
        
        Returns:
            tuple: (x, y) å®Ÿéš›ã®åº§æ¨™ï¼ˆã‚»ãƒ«ã®ä¸­å¿ƒï¼‰
        """
        x = (grid_x + 0.5) * self.cell_width
        y = (grid_y + 0.5) * self.cell_height
        return int(x), int(y)
    
    def click_grid(self, grid_x, grid_y):
        """ã‚°ãƒªãƒƒãƒ‰åº§æ¨™ã§ã‚¯ãƒªãƒƒã‚¯"""
        x, y = self.get_coordinates(grid_x, grid_y)
        
        self.driver.execute_script("""
            var x = arguments[0];
            var y = arguments[1];
            var element = document.elementFromPoint(x, y);
            if (element) {
                element.click();
            }
        """, x, y)
        
        print(f"ã‚°ãƒªãƒƒãƒ‰ ({grid_x}, {grid_y}) = åº§æ¨™ ({x}, {y}) ã‚’ã‚¯ãƒªãƒƒã‚¯")
    
    def visualize_grid(self):
        """ã‚°ãƒªãƒƒãƒ‰ã‚’å¯è¦–åŒ–ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰"""
        self.driver.execute_script("""
            var grid_width = arguments[0];
            var grid_height = arguments[1];
            var vw = window.innerWidth;
            var vh = window.innerHeight;
            var cell_w = vw / grid_width;
            var cell_h = vh / grid_height;
            
            // ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚’ä½œæˆ
            var overlay = document.createElement('div');
            overlay.id = 'coordinate-grid-overlay';
            overlay.style.cssText = 'position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; pointer-events: none; z-index: 99999;';
            
            // ã‚°ãƒªãƒƒãƒ‰ç·šã‚’æç”»
            for (var i = 0; i <= grid_width; i++) {
                var line = document.createElement('div');
                line.style.cssText = 'position: absolute; left: ' + (i * cell_w) + 'px; top: 0; width: 1px; height: 100%; background: rgba(255, 0, 0, 0.5);';
                overlay.appendChild(line);
            }
            
            for (var i = 0; i <= grid_height; i++) {
                var line = document.createElement('div');
                line.style.cssText = 'position: absolute; left: 0; top: ' + (i * cell_h) + 'px; width: 100%; height: 1px; background: rgba(255, 0, 0, 0.5);';
                overlay.appendChild(line);
            }
            
            document.body.appendChild(overlay);
        """, self.grid_width, self.grid_height)


# ===== ä½¿ç”¨ä¾‹ =====
driver = webdriver.Chrome()
driver.get("https://example.com")

# 10Ã—10ã®ã‚°ãƒªãƒƒãƒ‰ã‚’ä½œæˆ
grid = CoordinateGrid(driver, grid_width=10, grid_height=10)

# ã‚°ãƒªãƒƒãƒ‰ã‚’å¯è¦–åŒ–ï¼ˆãƒ‡ãƒãƒƒã‚°æ™‚ï¼‰
grid.visualize_grid()
time.sleep(2)

# ã‚°ãƒªãƒƒãƒ‰åº§æ¨™ã§ã‚¯ãƒªãƒƒã‚¯
# ä¾‹ï¼šå·¦ä¸Šã‹ã‚‰3ãƒã‚¹ç›®ã€ä¸Šã‹ã‚‰2ãƒã‚¹ç›®
grid.click_grid(2, 1)

time.sleep(1)

# å³ä¸‹ã‚¨ãƒªã‚¢ã‚’ã‚¯ãƒªãƒƒã‚¯
grid.click_grid(8, 8)
```

---

## ğŸ”„ æ–¹æ³•7: ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ« + åº§æ¨™æ“ä½œ

### ãƒšãƒ¼ã‚¸å†…ã®è¦‹ãˆãªã„è¦ç´ ã¸ã®åº§æ¨™ã‚¢ã‚¯ã‚»ã‚¹

```python
# ===== ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã—ã¦åº§æ¨™ã‚¯ãƒªãƒƒã‚¯ =====
def scroll_and_click_coordinates(driver, x, y):
    """
    ãƒšãƒ¼ã‚¸å…¨ä½“ã®åº§æ¨™ã§ã‚¯ãƒªãƒƒã‚¯ï¼ˆã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«è€ƒæ…®ï¼‰
    
    Args:
        driver: Seleniumãƒ‰ãƒ©ã‚¤ãƒãƒ¼
        x: ãƒšãƒ¼ã‚¸å…¨ä½“ã§ã®Xåº§æ¨™
        y: ãƒšãƒ¼ã‚¸å…¨ä½“ã§ã®Yåº§æ¨™
    """
    # ç¾åœ¨ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä½ç½®ã‚’å–å¾—
    scroll_y = driver.execute_script("return window.pageYOffset;")
    scroll_x = driver.execute_script("return window.pageXOffset;")
    
    # ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆå†…ã®åº§æ¨™ã«å¤‰æ›
    viewport_x = x - scroll_x
    viewport_y = y - scroll_y
    
    # ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆå¤–ã®å ´åˆã¯ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
    viewport_height = driver.execute_script("return window.innerHeight;")
    viewport_width = driver.execute_script("return window.innerWidth;")
    
    if viewport_y < 0 or viewport_y > viewport_height:
        # Yåº§æ¨™ãŒç”»é¢ã«åã¾ã‚‹ã‚ˆã†ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
        target_scroll_y = y - viewport_height / 2
        driver.execute_script(f"window.scrollTo(0, {target_scroll_y});")
        time.sleep(0.5)
    
    if viewport_x < 0 or viewport_x > viewport_width:
        # Xåº§æ¨™ãŒç”»é¢ã«åã¾ã‚‹ã‚ˆã†ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
        target_scroll_x = x - viewport_width / 2
        driver.execute_script(f"window.scrollTo({target_scroll_x}, window.pageYOffset);")
        time.sleep(0.5)
    
    # å†è¨ˆç®—
    scroll_y = driver.execute_script("return window.pageYOffset;")
    scroll_x = driver.execute_script("return window.pageXOffset;")
    viewport_x = x - scroll_x
    viewport_y = y - scroll_y
    
    # ã‚¯ãƒªãƒƒã‚¯å®Ÿè¡Œ
    driver.execute_script("""
        var x = arguments[0];
        var y = arguments[1];
        var element = document.elementFromPoint(x, y);
        if (element) {
            element.click();
        }
    """, viewport_x, viewport_y)
    
    print(f"ãƒšãƒ¼ã‚¸åº§æ¨™ ({x}, {y}) ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã—ãŸ")


# ===== ä½¿ç”¨ä¾‹ =====
driver.get("https://example.com/long-page")
time.sleep(2)

# ãƒšãƒ¼ã‚¸ä¸‹éƒ¨ã®åº§æ¨™ã‚’ã‚¯ãƒªãƒƒã‚¯ï¼ˆè‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ï¼‰
scroll_and_click_coordinates(driver, 500, 2000)
```

---

## ğŸ’¡ å®Ÿè·µçš„ãªç·åˆä¾‹

```python
# ===== Canvas ã‚²ãƒ¼ãƒ ã®è‡ªå‹•æ“ä½œ =====
from selenium import webdriver
from selenium.webdriver.common.action_chains import ActionChains
import time

driver = webdriver.Chrome()
driver.get("https://example-game.com")
driver.maximize_window()
time.sleep(3)

# Canvasã‚’å–å¾—
canvas = driver.find_element(By.ID, "game-canvas")

# Canvasè¦ç´ ã®ã‚µã‚¤ã‚ºã¨ä½ç½®ã‚’å–å¾—
canvas_rect = driver.execute_script("""
    var canvas = arguments[0];
    var rect = canvas.getBoundingClientRect();
    return {
        x: rect.left,
        y: rect.top,
        width: rect.width,
        height: rect.height
    };
""", canvas)

print(f"Canvasä½ç½®: {canvas_rect}")

# ã‚²ãƒ¼ãƒ å†…ã®ä»®æƒ³åº§æ¨™ç³»ã‚’å®šç¾©ï¼ˆä¾‹ï¼š800x600ã®ã‚²ãƒ¼ãƒ ç”»é¢ï¼‰
GAME_WIDTH = 800
GAME_HEIGHT = 600

def game_to_canvas_coords(game_x, game_y):
    """
    ã‚²ãƒ¼ãƒ å†…åº§æ¨™ã‚’Canvasè¦ç´ å†…ã®åº§æ¨™ã«å¤‰æ›
    """
    # ã‚²ãƒ¼ãƒ åº§æ¨™ã‚’Canvasåº§æ¨™ã«ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°
    canvas_x = (game_x / GAME_WIDTH) * canvas_rect['width']
    canvas_y = (game_y / GAME_HEIGHT) * canvas_rect['height']
    return int(canvas_x), int(canvas_y)

def click_game_position(game_x, game_y):
    """ã‚²ãƒ¼ãƒ å†…åº§æ¨™ã§ã‚¯ãƒªãƒƒã‚¯"""
    canvas_x, canvas_y = game_to_canvas_coords(game_x, game_y)
    
    actions = ActionChains(driver)
    actions.move_to_element_with_offset(canvas, canvas_x, canvas_y)
    actions.click()
    actions.perform()
    actions.reset_actions()
    
    print(f"ã‚²ãƒ¼ãƒ åº§æ¨™ ({game_x}, {game_y}) ã‚’ã‚¯ãƒªãƒƒã‚¯")

# ã‚²ãƒ¼ãƒ ãƒ—ãƒ¬ã‚¤ã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹
# ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®åˆæœŸä½ç½®ã‚’ã‚¯ãƒªãƒƒã‚¯
click_game_position(400, 500)  # ç”»é¢ä¸‹ä¸­å¤®
time.sleep(1)

# ã‚¢ã‚¤ãƒ†ãƒ ã®ä½ç½®ã‚’ã‚¯ãƒªãƒƒã‚¯
click_game_position(200, 300)
time.sleep(1)

# æ•µã®ä½ç½®ã‚’ã‚¯ãƒªãƒƒã‚¯
click_game_position(600, 200)
time.sleep(1)

# è¤‡é›‘ãªãƒ‘ã‚¹ã‚’æç”»ï¼ˆãƒ‰ãƒ©ãƒƒã‚°æ“ä½œï¼‰
path = [
    (100, 100),
    (200, 150),
    (300, 200),
    (400, 250),
    (500, 300)
]

# æœ€åˆã®ç‚¹ã«ç§»å‹•
start_x, start_y = game_to_canvas_coords(*path[0])
actions = ActionChains(driver)
actions.move_to_element_with_offset(canvas, start_x, start_y)
actions.click_and_hold()

# ãƒ‘ã‚¹ã«æ²¿ã£ã¦ç§»å‹•
for game_x, game_y in path[1:]:
    canvas_x, canvas_y = game_to_canvas_coords(game_x, game_y)
    actions.move_to_element_with_offset(canvas, canvas_x, canvas_y)
    time.sleep(0.1)

actions.release()
actions.perform()
actions.reset_actions()

print("ãƒ‘ã‚¹æç”»å®Œäº†")
```

---

## ğŸ› ï¸ ãƒ‡ãƒãƒƒã‚°ç”¨ãƒ„ãƒ¼ãƒ«

### åº§æ¨™ã‚’å¯è¦–åŒ–ã™ã‚‹é–¢æ•°

```python
def show_click_marker(driver, x, y, duration=2):
    """
    ã‚¯ãƒªãƒƒã‚¯ä½ç½®ã«ãƒãƒ¼ã‚«ãƒ¼ã‚’è¡¨ç¤ºï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰
    
    Args:
        driver: Seleniumãƒ‰ãƒ©ã‚¤ãƒãƒ¼
        x: Xåº§æ¨™
        y: Yåº§æ¨™
        duration: è¡¨ç¤ºæ™‚é–“ï¼ˆç§’ï¼‰
    """
    driver.execute_script("""
        var x = arguments[0];
        var y = arguments[1];
        var duration = arguments[2];
        
        // ãƒãƒ¼ã‚«ãƒ¼ã‚’ä½œæˆ
        var marker = document.createElement('div');
        marker.style.cssText = `
            position: fixed;
            left: ${x - 10}px;
            top: ${y - 10}px;
            width: 20px;
            height: 20px;
            background: rgba(255, 0, 0, 0.7);
            border: 2px solid red;
            border-radius: 50%;
            z-index: 999999;
            pointer-events: none;
        `;
        
        document.body.appendChild(marker);
        
        // æŒ‡å®šæ™‚é–“å¾Œã«å‰Šé™¤
        setTimeout(function() {
            document.body.removeChild(marker);
        }, duration * 1000);
    """, x, y, duration)


def log_all_clickable_coordinates(driver):
    """
    ãƒšãƒ¼ã‚¸å†…ã®ã‚¯ãƒªãƒƒã‚¯å¯èƒ½ãªè¦ç´ ã®åº§æ¨™ã‚’ãƒ­ã‚°å‡ºåŠ›
    """
    clickable_elements = driver.find_elements(By.CSS_SELECTOR, 
        "a, button, input[type='button'], input[type='submit'], [onclick]")
    
    print(f"ã‚¯ãƒªãƒƒã‚¯å¯èƒ½ãªè¦ç´ : {len(clickable_elements)}å€‹")
    
    for i, element in enumerate(clickable_elements):
        try:
            location = driver.execute_script("""
                var elem = arguments[0];
                var rect = elem.getBoundingClientRect();
                return {
                    x: Math.round(rect.left + rect.width/2),
                    y: Math.round(rect.top + rect.height/2),
                    tag: elem.tagName,
                    text: elem.textContent.trim().substring(0, 30)
                };
            """, element)
            
            print(f"{i+1}. ({location['x']}, {location['y']}) - {location['tag']}: {location['text']}")
        except:
            continue


# ===== ä½¿ç”¨ä¾‹ =====
driver.get("https://example.com")
time.sleep(2)

# å…¨ã¦ã®ã‚¯ãƒªãƒƒã‚¯å¯èƒ½è¦ç´ ã®åº§æ¨™ã‚’ãƒ­ã‚°
log_all_clickable_coordinates(driver)

# ç‰¹å®šåº§æ¨™ã«ãƒãƒ¼ã‚«ãƒ¼ã‚’è¡¨ç¤ºã—ã¦ã‚¯ãƒªãƒƒã‚¯
show_click_marker(driver, 300, 400, duration=3)
time.sleep(1)
driver.execute_script("document.elementFromPoint(300, 400).click();")
```

---

## âš ï¸ æ³¨æ„

## âš ï¸ æ³¨æ„ç‚¹ã¨ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### åº§æ¨™æŒ‡å®šã®è½ã¨ã—ç©´

```python
# ===== å•é¡Œ1: ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚ºãƒ¼ãƒ ç‡ã®å½±éŸ¿ =====
# ãƒ–ãƒ©ã‚¦ã‚¶ãŒæ‹¡å¤§/ç¸®å°ã•ã‚Œã¦ã„ã‚‹ã¨åº§æ¨™ãŒã‚ºãƒ¬ã‚‹

# è§£æ±ºç­–: ã‚ºãƒ¼ãƒ ã‚’100%ã«å›ºå®š
driver.execute_script("document.body.style.zoom='100%'")

# ã¾ãŸã¯ã€ã‚ºãƒ¼ãƒ ç‡ã‚’å–å¾—ã—ã¦è£œæ­£
zoom_level = driver.execute_script("return window.devicePixelRatio")
print(f"ã‚ºãƒ¼ãƒ ç‡: {zoom_level}")

# åº§æ¨™ã‚’è£œæ­£
actual_x = target_x * zoom_level
actual_y = target_y * zoom_level


# ===== å•é¡Œ2: ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚µã‚¤ã‚ºã®å¤‰åŒ– =====
# ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚µã‚¤ã‚ºãŒå¤‰ã‚ã‚‹ã¨åº§æ¨™ãŒã‚ºãƒ¬ã‚‹

# è§£æ±ºç­–: ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚µã‚¤ã‚ºã‚’å›ºå®š
driver.set_window_size(1920, 1080)

# ã¾ãŸã¯ã€æœ€å¤§åŒ–
driver.maximize_window()


# ===== å•é¡Œ3: ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä½ç½®ã®å½±éŸ¿ =====
# ãƒšãƒ¼ã‚¸ãŒã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã¨åº§æ¨™ãŒã‚ºãƒ¬ã‚‹

# è§£æ±ºç­–: ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä½ç½®ã‚’ãƒªã‚»ãƒƒãƒˆ
driver.execute_script("window.scrollTo(0, 0);")
time.sleep(0.5)

# ã¾ãŸã¯ã€ç¾åœ¨ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä½ç½®ã‚’å–å¾—ã—ã¦è£œæ­£
scroll_x = driver.execute_script("return window.pageXOffset")
scroll_y = driver.execute_script("return window.pageYOffset")
adjusted_y = target_y - scroll_y


# ===== å•é¡Œ4: iframeã‚„shadow DOMå†…ã®è¦ç´  =====
# iframeå†…ã®è¦ç´ ã¯åˆ¥åº§æ¨™ç³»

# è§£æ±ºç­–: iframeã«åˆ‡ã‚Šæ›¿ãˆã¦ã‹ã‚‰æ“ä½œ
iframe = driver.find_element(By.TAG_NAME, "iframe")
driver.switch_to.frame(iframe)

# iframeå†…ã§åº§æ¨™ã‚¯ãƒªãƒƒã‚¯
driver.execute_script("""
    document.elementFromPoint(100, 200).click();
""")

# å…ƒã«æˆ»ã™
driver.switch_to.default_content()


# ===== å•é¡Œ5: è¦ç´ ãŒå‹•çš„ã«ç§»å‹•ã™ã‚‹ =====
# ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚„ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã§è¦ç´ ãŒç§»å‹•

# è§£æ±ºç­–: ç§»å‹•ãŒå®Œäº†ã™ã‚‹ã¾ã§å¾…æ©Ÿ
def wait_for_element_stable(driver, element, timeout=5):
    """è¦ç´ ã®ä½ç½®ãŒå®‰å®šã™ã‚‹ã¾ã§å¾…æ©Ÿ"""
    stable_count = 0
    last_location = None
    start_time = time.time()
    
    while time.time() - start_time < timeout:
        current_location = element.location
        
        if current_location == last_location:
            stable_count += 1
            if stable_count >= 3:  # 3å›é€£ç¶šã§åŒã˜ä½ç½®ãªã‚‰å®‰å®šã¨åˆ¤æ–­
                return True
        else:
            stable_count = 0
        
        last_location = current_location
        time.sleep(0.1)
    
    return False

# ä½¿ç”¨ä¾‹
element = driver.find_element(By.ID, "animated-button")
wait_for_element_stable(driver, element)
# ã“ã‚Œã§å®‰å…¨ã«ã‚¯ãƒªãƒƒã‚¯å¯èƒ½
```

---

## ğŸ¯ æ–¹æ³•8: åº§æ¨™ãƒãƒƒãƒ”ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ 

### åº§æ¨™ã‚’è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã§ç®¡ç†

```python
import json

# ===== åº§æ¨™ãƒãƒƒãƒ—ã‚’å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ã§ç®¡ç† =====
# coordinates.json
"""
{
    "login_page": {
        "username_field": [300, 200],
        "password_field": [300, 250],
        "login_button": [350, 320],
        "forgot_password": [400, 360]
    },
    "dashboard": {
        "menu_button": [50, 100],
        "profile_icon": [1850, 50],
        "search_box": [800, 80]
    },
    "product_page": {
        "add_to_cart": [950, 650],
        "buy_now": [950, 700],
        "quantity_plus": [420, 550],
        "quantity_minus": [350, 550]
    }
}
"""

class CoordinateManager:
    def __init__(self, driver, config_file='coordinates.json'):
        self.driver = driver
        self.coordinates = self.load_coordinates(config_file)
    
    def load_coordinates(self, config_file):
        """åº§æ¨™è¨­å®šã‚’èª­ã¿è¾¼ã¿"""
        with open(config_file, 'r', encoding='utf-8') as f:
            return json.load(f)
    
    def save_coordinates(self, config_file='coordinates.json'):
        """åº§æ¨™è¨­å®šã‚’ä¿å­˜"""
        with open(config_file, 'w', encoding='utf-8') as f:
            json.dump(self.coordinates, f, indent=4, ensure_ascii=False)
    
    def add_coordinate(self, page, element_name, x, y):
        """æ–°ã—ã„åº§æ¨™ã‚’è¿½åŠ """
        if page not in self.coordinates:
            self.coordinates[page] = {}
        self.coordinates[page][element_name] = [x, y]
    
    def get_coordinate(self, page, element_name):
        """åº§æ¨™ã‚’å–å¾—"""
        try:
            return self.coordinates[page][element_name]
        except KeyError:
            raise ValueError(f"åº§æ¨™ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: {page}.{element_name}")
    
    def click(self, page, element_name, show_marker=False):
        """åº§æ¨™ã§ã‚¯ãƒªãƒƒã‚¯"""
        x, y = self.get_coordinate(page, element_name)
        
        if show_marker:
            self.show_marker(x, y)
        
        self.driver.execute_script("""
            var x = arguments[0];
            var y = arguments[1];
            var element = document.elementFromPoint(x, y);
            if (element) {
                element.click();
            } else {
                throw new Error('è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
            }
        """, x, y)
        
        print(f"ã‚¯ãƒªãƒƒã‚¯: {page}.{element_name} at ({x}, {y})")
    
    def move_to(self, page, element_name, show_marker=False):
        """åº§æ¨™ã«ãƒã‚¦ã‚¹ã‚’ç§»å‹•"""
        x, y = self.get_coordinate(page, element_name)
        
        if show_marker:
            self.show_marker(x, y)
        
        actions = ActionChains(self.driver)
        actions.move_by_offset(x, y).perform()
        actions.reset_actions()
    
    def show_marker(self, x, y, duration=1):
        """ãƒ‡ãƒãƒƒã‚°ç”¨ãƒãƒ¼ã‚«ãƒ¼è¡¨ç¤º"""
        self.driver.execute_script("""
            var x = arguments[0];
            var y = arguments[1];
            var duration = arguments[2];
            
            var marker = document.createElement('div');
            marker.style.cssText = `
                position: fixed;
                left: ${x - 15}px;
                top: ${y - 15}px;
                width: 30px;
                height: 30px;
                background: rgba(255, 0, 0, 0.5);
                border: 3px solid red;
                border-radius: 50%;
                z-index: 999999;
                pointer-events: none;
                animation: pulse 0.5s infinite;
            `;
            
            var style = document.createElement('style');
            style.textContent = `
                @keyframes pulse {
                    0% { transform: scale(1); opacity: 0.7; }
                    50% { transform: scale(1.2); opacity: 1; }
                    100% { transform: scale(1); opacity: 0.7; }
                }
            `;
            document.head.appendChild(style);
            document.body.appendChild(marker);
            
            setTimeout(function() {
                document.body.removeChild(marker);
            }, duration * 1000);
        """, x, y, duration)
    
    def calibrate(self, page, element_name):
        """
        åº§æ¨™ã‚­ãƒ£ãƒªãƒ–ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆæ‰‹å‹•èª¿æ•´ç”¨ï¼‰
        ãƒ–ãƒ©ã‚¦ã‚¶ä¸Šã§ã‚¯ãƒªãƒƒã‚¯ã—ãŸä½ç½®ã‚’è¨˜éŒ²
        """
        print(f"\n=== åº§æ¨™ã‚­ãƒ£ãƒªãƒ–ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ ===")
        print(f"ãƒšãƒ¼ã‚¸: {page}")
        print(f"è¦ç´ : {element_name}")
        print("ãƒ–ãƒ©ã‚¦ã‚¶ä¸Šã§ç›®çš„ã®ä½ç½®ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„...")
        
        # ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£
        coordinates = self.driver.execute_script("""
            return new Promise((resolve) => {
                document.addEventListener('click', function handler(e) {
                    document.removeEventListener('click', handler);
                    resolve({x: e.clientX, y: e.clientY});
                });
            });
        """)
        
        x = coordinates['x']
        y = coordinates['y']
        
        print(f"åº§æ¨™ã‚’è¨˜éŒ²ã—ã¾ã—ãŸ: ({x}, {y})")
        
        self.add_coordinate(page, element_name, x, y)
        self.show_marker(x, y, duration=2)
        
        return x, y


# ===== ä½¿ç”¨ä¾‹ =====
driver = webdriver.Chrome()
driver.maximize_window()

# åº§æ¨™ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã‚’åˆæœŸåŒ–
coord_mgr = CoordinateManager(driver)

# ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã¸ç§»å‹•
driver.get("https://example.com/login")
time.sleep(2)

# åº§æ¨™ã§ã‚¯ãƒªãƒƒã‚¯ï¼ˆãƒãƒ¼ã‚«ãƒ¼è¡¨ç¤ºã‚ã‚Šï¼‰
coord_mgr.click('login_page', 'username_field', show_marker=True)
time.sleep(0.5)
driver.find_element(By.TAG_NAME, "body").send_keys("username@example.com")

coord_mgr.click('login_page', 'password_field', show_marker=True)
time.sleep(0.5)
driver.find_element(By.TAG_NAME, "body").send_keys("password123")

coord_mgr.click('login_page', 'login_button', show_marker=True)
time.sleep(3)

# ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒšãƒ¼ã‚¸
coord_mgr.click('dashboard', 'search_box', show_marker=True)

# æ–°ã—ã„åº§æ¨™ã‚’ã‚­ãƒ£ãƒªãƒ–ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
# coord_mgr.calibrate('new_page', 'new_button')
# coord_mgr.save_coordinates()  # ä¿å­˜
```

---

## ğŸ® æ–¹æ³•9: ã‚²ãƒ¼ãƒ è‡ªå‹•åŒ–ã®å®Ÿè·µä¾‹

### å®Œå…¨ãªåº§æ¨™ãƒ™ãƒ¼ã‚¹ã‚²ãƒ¼ãƒ ãƒœãƒƒãƒˆ

```python
import random
import time
from dataclasses import dataclass
from typing import List, Tuple

@dataclass
class GameCoordinate:
    """ã‚²ãƒ¼ãƒ å†…åº§æ¨™ã‚’è¡¨ã™ã‚¯ãƒ©ã‚¹"""
    x: int
    y: int
    name: str = ""
    
    def __repr__(self):
        return f"{self.name}({self.x}, {self.y})" if self.name else f"({self.x}, {self.y})"


class GameBot:
    def __init__(self, driver, canvas_element):
        self.driver = driver
        self.canvas = canvas_element
        
        # Canvasè¦ç´ ã®æƒ…å ±ã‚’å–å¾—
        self.canvas_info = driver.execute_script("""
            var canvas = arguments[0];
            var rect = canvas.getBoundingClientRect();
            return {
                x: rect.left + window.pageXOffset,
                y: rect.top + window.pageYOffset,
                width: rect.width,
                height: rect.height,
                viewportX: rect.left,
                viewportY: rect.top
            };
        """, canvas_element)
        
        print(f"Canvasæƒ…å ±: {self.canvas_info}")
    
    def game_to_screen(self, game_coord: GameCoordinate) -> Tuple[int, int]:
        """ã‚²ãƒ¼ãƒ åº§æ¨™ã‚’ç”»é¢åº§æ¨™ã«å¤‰æ›"""
        # Canvasã®ç›¸å¯¾åº§æ¨™ã«å¤‰æ›
        screen_x = self.canvas_info['viewportX'] + game_coord.x
        screen_y = self.canvas_info['viewportY'] + game_coord.y
        return int(screen_x), int(screen_y)
    
    def click_game_coord(self, coord: GameCoordinate, double_click=False):
        """ã‚²ãƒ¼ãƒ åº§æ¨™ã‚’ã‚¯ãƒªãƒƒã‚¯"""
        screen_x, screen_y = self.game_to_screen(coord)
        
        print(f"ã‚¯ãƒªãƒƒã‚¯: {coord} -> ç”»é¢åº§æ¨™({screen_x}, {screen_y})")
        
        self.driver.execute_script("""
            var x = arguments[0];
            var y = arguments[1];
            var doubleClick = arguments[2];
            var element = document.elementFromPoint(x, y);
            
            if (element) {
                element.click();
                if (doubleClick) {
                    setTimeout(() => element.click(), 100);
                }
            }
        """, screen_x, screen_y, double_click)
        
        time.sleep(0.2)
    
    def drag_path(self, start: GameCoordinate, end: GameCoordinate, duration=1.0):
        """ãƒ‰ãƒ©ãƒƒã‚°æ“ä½œ"""
        print(f"ãƒ‰ãƒ©ãƒƒã‚°: {start} -> {end}")
        
        # é–‹å§‹ç‚¹ã«ç§»å‹•
        actions = ActionChains(self.driver)
        actions.move_to_element_with_offset(
            self.canvas, start.x, start.y
        )
        actions.click_and_hold()
        
        # çµ‚ç‚¹ã¾ã§ç§»å‹•
        steps = 10
        for i in range(1, steps + 1):
            progress = i / steps
            x = int(start.x + (end.x - start.x) * progress)
            y = int(start.y + (end.y - start.y) * progress)
            
            actions.move_to_element_with_offset(self.canvas, x, y)
            time.sleep(duration / steps)
        
        actions.release()
        actions.perform()
        actions.reset_actions()
    
    def click_sequence(self, coords: List[GameCoordinate], interval=0.5):
        """åº§æ¨™ãƒªã‚¹ãƒˆã‚’é †ç•ªã«ã‚¯ãƒªãƒƒã‚¯"""
        for coord in coords:
            self.click_game_coord(coord)
            time.sleep(interval)
    
    def random_click_in_area(self, 
                            top_left: GameCoordinate, 
                            bottom_right: GameCoordinate,
                            count=5):
        """ã‚¨ãƒªã‚¢å†…ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«ã‚¯ãƒªãƒƒã‚¯"""
        print(f"ãƒ©ãƒ³ãƒ€ãƒ ã‚¯ãƒªãƒƒã‚¯: {top_left} ~ {bottom_right} ã‚’{count}å›")
        
        for i in range(count):
            x = random.randint(top_left.x, bottom_right.x)
            y = random.randint(top_left.y, bottom_right.y)
            
            random_coord = GameCoordinate(x, y, f"ãƒ©ãƒ³ãƒ€ãƒ {i+1}")
            self.click_game_coord(random_coord)
            time.sleep(random.uniform(0.3, 0.8))
    
    def patrol_path(self, waypoints: List[GameCoordinate], loops=1):
        """ãƒ‘ãƒˆãƒ­ãƒ¼ãƒ«ãƒ«ãƒ¼ãƒˆ"""
        for loop in range(loops):
            print(f"ãƒ‘ãƒˆãƒ­ãƒ¼ãƒ« {loop+1}/{loops}")
            
            for i in range(len(waypoints)):
                current = waypoints[i]
                next_point = waypoints[(i + 1) % len(waypoints)]
                
                self.click_game_coord(current)
                time.sleep(1)
                
                # æ¬¡ã®ãƒã‚¤ãƒ³ãƒˆã¸ç§»å‹•ï¼ˆã‚²ãƒ¼ãƒ ã«ã‚ˆã£ã¦ã¯ãƒ‰ãƒ©ãƒƒã‚°ã§æ“ä½œï¼‰
                # self.drag_path(current, next_point, duration=2)
    
    def highlight_coordinate(self, coord: GameCoordinate, duration=2):
        """åº§æ¨™ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆè¡¨ç¤ºï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰"""
        screen_x, screen_y = self.game_to_screen(coord)
        
        self.driver.execute_script("""
            var x = arguments[0];
            var y = arguments[1];
            var name = arguments[2];
            var duration = arguments[3];
            
            var marker = document.createElement('div');
            marker.innerHTML = `
                <div style="
                    position: fixed;
                    left: ${x - 20}px;
                    top: ${y - 20}px;
                    width: 40px;
                    height: 40px;
                    border: 3px solid lime;
                    border-radius: 50%;
                    background: rgba(0, 255, 0, 0.2);
                    z-index: 999999;
                    pointer-events: none;
                "></div>
                <div style="
                    position: fixed;
                    left: ${x + 25}px;
                    top: ${y - 10}px;
                    background: rgba(0, 0, 0, 0.8);
                    color: lime;
                    padding: 5px 10px;
                    border-radius: 5px;
                    font-size: 12px;
                    z-index: 999999;
                    pointer-events: none;
                ">${name}</div>
            `;
            
            document.body.appendChild(marker);
            
            setTimeout(() => {
                document.body.removeChild(marker);
            }, duration * 1000);
        """, screen_x, screen_y, coord.name, duration)


# ===== å®Ÿéš›ã®ã‚²ãƒ¼ãƒ ã§ä½¿ç”¨ =====
driver = webdriver.Chrome()
driver.maximize_window()
driver.get("https://example-game.com")
time.sleep(3)

# Canvasã‚’å–å¾—
canvas = driver.find_element(By.ID, "game-canvas")

# ã‚²ãƒ¼ãƒ ãƒœãƒƒãƒˆã‚’åˆæœŸåŒ–
bot = GameBot(driver, canvas)

# ã‚²ãƒ¼ãƒ å†…ã®é‡è¦ãªåº§æ¨™ã‚’å®šç¾©
coords = {
    'start_button': GameCoordinate(400, 500, "ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³"),
    'character': GameCoordinate(200, 400, "ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼"),
    'enemy1': GameCoordinate(600, 200, "æ•µ1"),
    'enemy2': GameCoordinate(700, 300, "æ•µ2"),
    'item_box': GameCoordinate(300, 250, "ã‚¢ã‚¤ãƒ†ãƒ ãƒœãƒƒã‚¯ã‚¹"),
    'checkpoint1': GameCoordinate(150, 150, "ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆ1"),
    'checkpoint2': GameCoordinate(650, 150, "ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆ2"),
}

# åº§æ¨™ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆè¡¨ç¤ºï¼ˆç¢ºèªç”¨ï¼‰
for coord in coords.values():
    bot.highlight_coordinate(coord, duration=3)
    time.sleep(0.5)

time.sleep(2)

# ã‚²ãƒ¼ãƒ é–‹å§‹
bot.click_game_coord(coords['start_button'])
time.sleep(2)

# ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚’é¸æŠ
bot.click_game_coord(coords['character'], double_click=True)
time.sleep(1)

# ã‚¢ã‚¤ãƒ†ãƒ ã‚’å–å¾—
bot.click_game_coord(coords['item_box'])
time.sleep(1)

# æ•µã‚’é †ç•ªã«æ”»æ’ƒ
bot.click_sequence([
    coords['enemy1'],
    coords['enemy2']
], interval=1.5)

# ãƒ‘ãƒˆãƒ­ãƒ¼ãƒ«ãƒ«ãƒ¼ãƒˆå®Ÿè¡Œ
patrol_route = [
    coords['checkpoint1'],
    coords['checkpoint2'],
    coords['item_box'],
    coords['character']
]
bot.patrol_path(patrol_route, loops=2)

# ã‚¨ãƒªã‚¢å†…ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«æ¢ç´¢
top_left = GameCoordinate(100, 100, "æ¢ç´¢ã‚¨ãƒªã‚¢å·¦ä¸Š")
bottom_right = GameCoordinate(700, 500, "æ¢ç´¢ã‚¨ãƒªã‚¢å³ä¸‹")
bot.random_click_in_area(top_left, bottom_right, count=10)
```

---

## ğŸ“± æ–¹æ³•10: ãƒ¢ãƒã‚¤ãƒ«ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ + åº§æ¨™æ“ä½œ

### ã‚¹ãƒãƒ›ç”»é¢ã§ã®åº§æ¨™ã‚¯ãƒªãƒƒã‚¯

```python
from selenium.webdriver.chrome.options import Options

# ===== ãƒ¢ãƒã‚¤ãƒ«ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š =====
mobile_emulation = {
    "deviceMetrics": { "width": 375, "height": 812, "pixelRatio": 3.0 },
    "userAgent": ("Mozilla/5.0 (iPhone; CPU iPhone OS 14_0 like Mac OS X) "
                  "AppleWebKit/605.1.15 (KHTML, like Gecko) "
                  "Version/14.0 Mobile/15E148 Safari/604.1")
}

chrome_options = Options()
chrome_options.add_experimental_option("mobileEmulation", mobile_emulation)

driver = webdriver.Chrome(options=chrome_options)

# ãƒ¢ãƒã‚¤ãƒ«ç”»é¢ç”¨ã®åº§æ¨™ãƒãƒƒãƒ—
mobile_coords = {
    'header': {
        'menu_icon': (30, 50),
        'search_icon': (345, 50),
        'cart_icon': (310, 50)
    },
    'product_list': {
        'first_product': (187, 300),
        'second_product': (187, 600),
        'third_product': (187, 900)
    },
    'footer': {
        'home_button': (75, 750),
        'category_button': (187, 750),
        'cart_button': (299, 750)
    }
}

def mobile_click(coord_tuple):
    """ãƒ¢ãƒã‚¤ãƒ«åº§æ¨™ã§ã‚¯ãƒªãƒƒã‚¯"""
    x, y = coord_tuple
    driver.execute_script(f"""
        document.elementFromPoint({x}, {y}).click();
    """)
    print(f"ãƒ¢ãƒã‚¤ãƒ«ã‚¯ãƒªãƒƒã‚¯: ({x}, {y})")

# ä½¿ç”¨ä¾‹
driver.get("https://m.example.com")
time.sleep(2)

# ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‹ã
mobile_click(mobile_coords['header']['menu_icon'])
time.sleep(1)

# å•†å“ã‚’ã‚¿ãƒƒãƒ—
mobile_click(mobile_coords['product_list']['first_product'])
time.sleep(2)

# ã‚«ãƒ¼ãƒˆã«è¿½åŠ 
mobile_click((187, 600))  # ã€Œã‚«ãƒ¼ãƒˆã«è¿½åŠ ã€ãƒœã‚¿ãƒ³ã®åº§æ¨™
```

---

## ğŸ”§ æ–¹æ³•11: åº§æ¨™è¨˜éŒ²ãƒ„ãƒ¼ãƒ«

### åº§æ¨™ã‚’ç°¡å˜ã«è¨˜éŒ²ã™ã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼ãƒ„ãƒ¼ãƒ«

```python
class CoordinateRecorder:
    """åº§æ¨™ã‚’è¨˜éŒ²ãƒ»ç®¡ç†ã™ã‚‹ãƒ„ãƒ¼ãƒ«"""
    
    def __init__(self, driver):
        self.driver = driver
        self.recorded_coords = {}
        self.recording_mode = False
    
    def start_recording(self):
        """åº§æ¨™è¨˜éŒ²ãƒ¢ãƒ¼ãƒ‰ã‚’é–‹å§‹"""
        print("\n=== åº§æ¨™è¨˜éŒ²ãƒ¢ãƒ¼ãƒ‰é–‹å§‹ ===")
        print("ãƒ–ãƒ©ã‚¦ã‚¶ä¸Šã§ã‚¯ãƒªãƒƒã‚¯ã—ãŸä½ç½®ãŒè¨˜éŒ²ã•ã‚Œã¾ã™")
        print("ESCã‚­ãƒ¼ã§çµ‚äº†")
        
        self.recording_mode = True
        
        # ã‚¯ãƒªãƒƒã‚¯è¨˜éŒ²ç”¨ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’æ³¨å…¥
        self.driver.execute_script("""
            window.recordedCoordinates = [];
            window.recordingActive = true;
            
            // ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£
            document.addEventListener('click', function(e) {
                if (window.recordingActive) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    var coord = {
                        x: e.clientX,
                        y: e.clientY,
                        target: e.target.tagName,
                        targetText: e.target.textContent.substring(0, 20)
                    };
                    
                    window.recordedCoordinates.push(coord);
                    
                    // è¦–è¦šçš„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
                    var marker = document.createElement('div');
                    marker.textContent = window.recordedCoordinates.length;
                    marker.style.cssText = `
                        position: fixed;
                        left: ${e.clientX - 15}px;
                        top: ${e.clientY - 15}px;
                        width: 30px;
                        height: 30px;
                        background: rgba(0, 255, 0, 0.8);
                        color: white;
                        border-radius: 50%;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        font-weight: bold;
                        z-index: 999999;
                        pointer-events: none;
                        font-size: 14px;
                    `;
                    document.body.appendChild(marker);
                    
                    setTimeout(() => {
                        marker.style.transform = 'scale(0)';
                        marker.style.transition = 'transform 0.3s';
                        setTimeout(() => document.body.removeChild(marker), 300);
                    }, 1500);
                }
            }, true);
            
            // ESCã‚­ãƒ¼ã§çµ‚äº†
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    window.recordingActive = false;
                }
            });
        """)
    
    def stop_recording(self):
        """åº§æ¨™è¨˜éŒ²ã‚’åœæ­¢ã—ã¦çµæœã‚’å–å¾—"""
        recorded = self.driver.execute_script("""
            window.recordingActive = false;
            return window.recordedCoordinates;
        """)
        
        print(f"\n=== è¨˜éŒ²å®Œäº†: {len(recorded)}å€‹ã®åº§æ¨™ ===\n")
        
        for i, coord in enumerate(recorded, 1):
            name = f"point_{i}"
            self.recorded_coords[name] = {
                'x': coord['x'],
                'y': coord['y'],
                'target': coord['target'],
                'text': coord['targetText']
            }
            print(f"{i}. ({coord['x']}, {coord['y']}) - {coord['target']}: {coord['targetText']}")
        
        return self.recorded_coords
    
    def export_to_json(self, filename='recorded_coordinates.json'):
        """è¨˜éŒ²ã—ãŸåº§æ¨™ã‚’JSONãƒ•ã‚¡ã‚¤ãƒ«ã«å‡ºåŠ›"""
        with open(filename, 'w', encoding='utf-8') as f:
            json.dump(self.recorded_coords, f, indent=4, ensure_ascii=False)
        print(f"\nåº§æ¨™ã‚’{filename}ã«ä¿å­˜ã—ã¾ã—ãŸ")
    
    def export_to_python(self, filename='coordinates.py'):
        """Pythonã‚³ãƒ¼ãƒ‰ã¨ã—ã¦å‡ºåŠ›"""
        with open(filename, 'w', encoding='utf-8') as f:
            f.write("# è‡ªå‹•ç”Ÿæˆã•ã‚ŒãŸåº§æ¨™ãƒ‡ãƒ¼ã‚¿\n\n")
            f.write("COORDINATES = {\n")
            for name, data in self.recorded_coords.items():
                f.write(f"    '{name}': {{'x': {data['x']}, 'y': {data['y']}}},  ")
                f.write(f"# {data['target']}: {data['text']}\n")
            f.write("}\n")
        print(f"\nPythonã‚³ãƒ¼ãƒ‰ã‚’{filename}ã«ä¿å­˜ã—ã¾ã—ãŸ")


# ===== ä½¿ç”¨ä¾‹ =====
driver = webdriver.Chrome()
driver.maximize_window()
driver.get("https://example.com")
time.sleep(2)

# åº§æ¨™ãƒ¬ã‚³ãƒ¼ãƒ€ãƒ¼ã‚’ä½œæˆ
recorder = CoordinateRecorder(driver)

# è¨˜éŒ²é–‹å§‹
recorder.start_recording()

# ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ–ãƒ©ã‚¦ã‚¶ä¸Šã§ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¾ã§å¾…æ©Ÿ
print("ãƒ–ãƒ©ã‚¦ã‚¶ä¸Šã§ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„...")
print("çµ‚äº†ã™ã‚‹ã«ã¯ESCã‚­ãƒ¼ã‚’æŠ¼ã—ã¦ãã ã•ã„")

# è¨˜éŒ²ãŒçµ‚ã‚ã‚‹ã¾ã§å¾…æ©Ÿï¼ˆå®Ÿéš›ã«ã¯WebDriverWaitãªã©ã‚’ä½¿ç”¨ï¼‰
input("è¨˜éŒ²ãŒå®Œäº†ã—ãŸã‚‰Enterã‚­ãƒ¼ã‚’æŠ¼ã—ã¦ãã ã•ã„...")

# è¨˜éŒ²åœæ­¢
coords = recorder.stop_recording()

# ãƒ•ã‚¡ã‚¤ãƒ«ã«å‡ºåŠ›
recorder.export_to_json('my_coordinates.json')
recorder.export_to_python('my_coordinates.py')

# è¨˜éŒ²ã—ãŸåº§æ¨™ã§è‡ªå‹•æ“ä½œãƒ†ã‚¹ãƒˆ
print("\nè¨˜éŒ²ã—ãŸåº§æ¨™ã§è‡ªå‹•æ“ä½œã‚’å®Ÿè¡Œã—ã¾ã™...")
for name, data in coords.items():
    driver.execute_script(f"""
        document.elementFromPoint({data['x']}, {data['y']}).click();
    """)
    print(f"{name}ã‚’ã‚¯ãƒªãƒƒã‚¯: ({data['x']}, {data['y']})")
    time.sleep(1)
```

---

## ğŸ“ ç·åˆã¾ã¨ã‚

### åº§æ¨™æŒ‡å®šã®é¸æŠãƒãƒ£ãƒ¼ãƒˆ

```
ã‚¯ãƒªãƒƒã‚¯ã—ãŸã„è¦ç´ ã¯ï¼Ÿ
â”‚
â”œâ”€ ã‚»ãƒ¬ã‚¯ã‚¿ã§å–å¾—å¯èƒ½
â”‚  â””â”€ âœ… é€šå¸¸ã®Seleniumæ“ä½œã‚’ä½¿ç”¨ï¼ˆæ¨å¥¨ï¼‰
â”‚
â”œâ”€ Canvas/SVGå†…
â”‚  â””â”€ ActionChains + move_to_element_with_offset
â”‚
â”œâ”€ Shadow DOMå†…
â”‚  â””â”€ JavaScriptåº§æ¨™ã‚¯ãƒªãƒƒã‚¯
â”‚
â”œâ”€ ç”»åƒã¨ã—ã¦èªè­˜
â”‚  â””â”€ PyAutoGUIç”»åƒèªè­˜ or OpenCV
â”‚
â”œâ”€ ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒª
â”‚  â””â”€ Appiumåº§æ¨™ã‚¿ãƒƒãƒ—
â”‚
â””â”€ è¤‡é›‘ãªã‚²ãƒ¼ãƒ /ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„
   â””â”€ åº§æ¨™ãƒãƒƒãƒ”ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ  + GameBot
```

### ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

```python
# ===== æ¨å¥¨ã•ã‚Œã‚‹ã‚³ãƒ¼ãƒ‰æ§‹é€  =====
class WebAutomation:
    def __init__(self, driver):
        self.driver = driver
        self.coord_manager = CoordinateManager(driver)
    
    def safe_coordinate_click(self, x, y, retries=3):
        """å®‰å…¨ãªåº§æ¨™ã‚¯ãƒªãƒƒã‚¯ï¼ˆãƒªãƒˆãƒ©ã‚¤ä»˜ãï¼‰"""
        for attempt in range(retries):
            try:
                # ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä½ç½®ã‚’ãƒªã‚»ãƒƒãƒˆ
                self.driver.execute_script("window.scrollTo(0, 0)")
                time.sleep(0.3)
                
                # è¦ç´ ã®ç¢ºèª
                element = self.driver.execute_script("""
                    return document.elementFromPoint(arguments[0], arguments[1]);
                """, x, y)
                
                if element:
                    # ã‚¯ãƒªãƒƒã‚¯å®Ÿè¡Œ
                    self.driver.execute_script("""
                        arguments[0].click();
                    """, element)
                    
                    print(f"âœ“ åº§æ¨™({x}, {y})ã‚¯ãƒªãƒƒã‚¯æˆåŠŸ")
                    return True
                else:
                    print(f"âœ— åº§æ¨™({x}, {y})ã«è¦ç´ ãªã— (è©¦è¡Œ {attempt+1}/{retries})")
                    
            except Exception as e:
                print(f"âœ— ã‚¨ãƒ©ãƒ¼: {e} (è©¦è¡Œ {attempt+1}/{retries})")
            
            time.sleep(0.5)
        
        print(f"âœ— åº§æ¨™({x}, {y})ã‚¯ãƒªãƒƒã‚¯å¤±æ•—")
        return False
```

åº§æ¨™æŒ‡å®šã¯**æœ€å¾Œã®æ‰‹æ®µ**ã¨ã—ã¦ä½¿ã„ã¾ã—


## ğŸ“ æœ€çµ‚ã¾ã¨ã‚ï¼šåº§æ¨™æŒ‡å®šã®å…¨æ‰‹æ³•ï¼ˆç¶šãï¼‰

### æ‰‹æ³•ã®æ¯”è¼ƒè¡¨

| æ‰‹æ³• | é›£æ˜“åº¦ | ç²¾åº¦ | é€Ÿåº¦ | ç”¨é€” |
|------|--------|------|------|------|
| **ActionChains** | â­â­ | â­â­â­â­ | â­â­â­â­ | Canvasè¦ç´ ã€ç›¸å¯¾åº§æ¨™ |
| **JavaScriptåº§æ¨™ã‚¯ãƒªãƒƒã‚¯** | â­â­â­ | â­â­â­â­â­ | â­â­â­â­â­ | å‹•çš„è¦ç´ ã€iframe |
| **PyAutoGUI** | â­ | â­â­â­ | â­â­â­ | OSå…¨ä½“ã€ç”»åƒèªè­˜ |
| **ç”»åƒèªè­˜ (OpenCV)** | â­â­â­â­ | â­â­â­ | â­â­ | UIã®å¤‰åŒ–ã«å¼·ã„ |
| **åº§æ¨™ãƒãƒƒãƒ”ãƒ³ã‚°** | â­â­â­ | â­â­â­â­ | â­â­â­â­ | è¤‡é›‘ãªã‚²ãƒ¼ãƒ  |
| **ã‚°ãƒªãƒƒãƒ‰ã‚·ã‚¹ãƒ†ãƒ ** | â­â­ | â­â­â­ | â­â­â­â­ | ãƒ‡ãƒãƒƒã‚°ã€ãƒ†ã‚¹ãƒˆ |

---

## ğŸ”¥ å®Ÿè·µçš„ãªç·åˆã‚µãƒ³ãƒ—ãƒ«

### ECã‚µã‚¤ãƒˆå®Œå…¨è‡ªå‹•æ“ä½œ

```python
"""
ECã‚µã‚¤ãƒˆã®å•†å“è³¼å…¥ã‚’åº§æ¨™æŒ‡å®šã§è‡ªå‹•åŒ–ã™ã‚‹å®Œå…¨ãªã‚µãƒ³ãƒ—ãƒ«
"""

import time
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC
from selenium.webdriver.common.action_chains import ActionChains
import json

class EcommerceAutomation:
    """ECã‚µã‚¤ãƒˆè‡ªå‹•æ“ä½œã‚¯ãƒ©ã‚¹"""
    
    def __init__(self, base_url, coordinates_file='ecommerce_coords.json'):
        # ãƒ‰ãƒ©ã‚¤ãƒãƒ¼åˆæœŸåŒ–
        self.driver = webdriver.Chrome()
        self.driver.maximize_window()
        self.base_url = base_url
        self.wait = WebDriverWait(self.driver, 10)
        
        # åº§æ¨™ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
        self.load_coordinates(coordinates_file)
        
        # ç”»é¢ã‚µã‚¤ã‚ºã‚’å–å¾—
        self.viewport = self.driver.execute_script("""
            return {
                width: window.innerWidth,
                height: window.innerHeight
            };
        """)
        
        print(f"åˆæœŸåŒ–å®Œäº† - ç”»é¢ã‚µã‚¤ã‚º: {self.viewport['width']}x{self.viewport['height']}")
    
    def load_coordinates(self, filename):
        """åº§æ¨™è¨­å®šã‚’èª­ã¿è¾¼ã¿"""
        try:
            with open(filename, 'r', encoding='utf-8') as f:
                self.coords = json.load(f)
            print(f"åº§æ¨™ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å®Œäº†: {filename}")
        except FileNotFoundError:
            print(f"åº§æ¨™ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: {filename}")
            print("ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆåº§æ¨™ã‚’ä½¿ç”¨ã—ã¾ã™")
            self.coords = self._default_coordinates()
    
    def _default_coordinates(self):
        """ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆåº§æ¨™ï¼ˆ1920x1080åŸºæº–ï¼‰"""
        return {
            "home": {
                "search_box": [800, 100],
                "cart_icon": [1800, 80],
                "menu_button": [50, 80]
            },
            "product_list": {
                "first_product": [300, 400],
                "second_product": [700, 400],
                "third_product": [1100, 400],
                "filter_button": [100, 300],
                "sort_dropdown": [1700, 250]
            },
            "product_detail": {
                "add_to_cart": [1400, 650],
                "quantity_plus": [1250, 550],
                "quantity_minus": [1150, 550],
                "size_selector": [1200, 450],
                "color_selector": [1200, 500],
                "reviews_tab": [600, 850],
                "description_tab": [400, 850]
            },
            "cart": {
                "checkout_button": [1500, 900],
                "continue_shopping": [400, 900],
                "remove_item": [1700, 400],
                "update_quantity": [1600, 450],
                "coupon_field": [800, 700],
                "apply_coupon": [1000, 700]
            },
            "checkout": {
                "name_field": [600, 300],
                "email_field": [600, 350],
                "address_field": [600, 400],
                "city_field": [600, 450],
                "zip_field": [600, 500],
                "phone_field": [600, 550],
                "payment_card": [500, 700],
                "payment_paypal": [700, 700],
                "place_order": [800, 900]
            }
        }
    
    def safe_click(self, x, y, description="", retries=3, show_marker=True):
        """
        å®‰å…¨ãªåº§æ¨™ã‚¯ãƒªãƒƒã‚¯
        
        Args:
            x: Xåº§æ¨™
            y: Yåº§æ¨™
            description: æ“ä½œã®èª¬æ˜
            retries: ãƒªãƒˆãƒ©ã‚¤å›æ•°
            show_marker: ãƒãƒ¼ã‚«ãƒ¼è¡¨ç¤º
        """
        for attempt in range(retries):
            try:
                if show_marker:
                    self._show_click_marker(x, y, description)
                
                # ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä½ç½®ã‚’ãƒªã‚»ãƒƒãƒˆ
                self.driver.execute_script("window.scrollTo(0, 0);")
                time.sleep(0.2)
                
                # è¦ç´ ã‚’ã‚¯ãƒªãƒƒã‚¯
                element = self.driver.execute_script("""
                    var x = arguments[0];
                    var y = arguments[1];
                    var element = document.elementFromPoint(x, y);
                    
                    if (element) {
                        element.click();
                        return true;
                    }
                    return false;
                """, x, y)
                
                if element:
                    print(f"âœ“ {description} ã‚’ã‚¯ãƒªãƒƒã‚¯: ({x}, {y})")
                    time.sleep(0.5)
                    return True
                else:
                    print(f"âœ— è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ (è©¦è¡Œ {attempt+1}/{retries})")
                    
            except Exception as e:
                print(f"âœ— ã‚¨ãƒ©ãƒ¼: {e} (è©¦è¡Œ {attempt+1}/{retries})")
            
            time.sleep(0.5)
        
        print(f"âœ— {description} ã®ã‚¯ãƒªãƒƒã‚¯ã«å¤±æ•—ã—ã¾ã—ãŸ")
        return False
    
    def _show_click_marker(self, x, y, text=""):
        """ã‚¯ãƒªãƒƒã‚¯ä½ç½®ã«ãƒãƒ¼ã‚«ãƒ¼ã‚’è¡¨ç¤º"""
        self.driver.execute_script("""
            var x = arguments[0];
            var y = arguments[1];
            var text = arguments[2];
            
            var marker = document.createElement('div');
            marker.innerHTML = `
                <div style="
                    position: fixed;
                    left: ${x - 15}px;
                    top: ${y - 15}px;
                    width: 30px;
                    height: 30px;
                    background: rgba(255, 0, 0, 0.6);
                    border: 3px solid red;
                    border-radius: 50%;
                    z-index: 999999;
                    pointer-events: none;
                    animation: pulse 0.5s ease-in-out;
                "></div>
                <div style="
                    position: fixed;
                    left: ${x + 20}px;
                    top: ${y - 10}px;
                    background: rgba(0, 0, 0, 0.9);
                    color: white;
                    padding: 5px 10px;
                    border-radius: 5px;
                    font-size: 12px;
                    z-index: 999999;
                    pointer-events: none;
                ">${text}</div>
            `;
            
            var style = document.createElement('style');
            style.textContent = '@keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.3); } 100% { transform: scale(1); } }';
            document.head.appendChild(style);
            
            document.body.appendChild(marker);
            setTimeout(() => document.body.removeChild(marker), 1500);
        """, x, y, text)
    
    def type_text_at_coordinate(self, x, y, text, description=""):
        """åº§æ¨™ä½ç½®ã§ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›"""
        if self.safe_click(x, y, description):
            time.sleep(0.3)
            
            # ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªè¦ç´ ã«ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›
            self.driver.switch_to.active_element.clear()
            self.driver.switch_to.active_element.send_keys(text)
            
            print(f"  â†’ ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›: {text}")
            time.sleep(0.5)
            return True
        return False
    
    def scroll_to_coordinate(self, y_position):
        """æŒ‡å®šYåº§æ¨™ã¾ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«"""
        self.driver.execute_script(f"window.scrollTo(0, {y_position});")
        time.sleep(0.5)
    
    # ===== ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ =====
    
    def navigate_to_home(self):
        """ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ã«ç§»å‹•"""
        print("\n=== ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ã¸ç§»å‹• ===")
        self.driver.get(self.base_url)
        time.sleep(2)
    
    def search_product(self, keyword):
        """å•†å“æ¤œç´¢"""
        print(f"\n=== å•†å“æ¤œç´¢: {keyword} ===")
        
        coords = self.coords['home']['search_box']
        if self.type_text_at_coordinate(coords[0], coords[1], keyword, "æ¤œç´¢ãƒœãƒƒã‚¯ã‚¹"):
            # Enterã‚­ãƒ¼ã‚’æŠ¼ã™
            self.driver.switch_to.active_element.send_keys("\n")
            time.sleep(2)
            return True
        return False
    
    def select_product(self, position=1):
        """å•†å“ã‚’é¸æŠï¼ˆ1=æœ€åˆã®å•†å“ã€2=2ç•ªç›®...ï¼‰"""
        print(f"\n=== å•†å“é¸æŠ: {position}ç•ªç›® ===")
        
        product_map = {
            1: 'first_product',
            2: 'second_product',
            3: 'third_product'
        }
        
        product_key = product_map.get(position, 'first_product')
        coords = self.coords['product_list'][product_key]
        
        # ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã—ã¦å•†å“ã‚’è¡¨ç¤º
        self.scroll_to_coordinate(300)
        
        if self.safe_click(coords[0], coords[1], f"{position}ç•ªç›®ã®å•†å“"):
            time.sleep(2)
            return True
        return False
    
    def add_to_cart(self, quantity=1):
        """ã‚«ãƒ¼ãƒˆã«è¿½åŠ """
        print(f"\n=== ã‚«ãƒ¼ãƒˆã«è¿½åŠ : æ•°é‡ {quantity} ===")
        
        # æ•°é‡ã‚’èª¿æ•´
        if quantity > 1:
            plus_coords = self.coords['product_detail']['quantity_plus']
            for i in range(quantity - 1):
                self.safe_click(plus_coords[0], plus_coords[1], 
                               f"æ•°é‡å¢—åŠ  ({i+2}/{quantity})", show_marker=False)
                time.sleep(0.3)
        
        # ã‚«ãƒ¼ãƒˆã«è¿½åŠ ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
        add_coords = self.coords['product_detail']['add_to_cart']
        if self.safe_click(add_coords[0], add_coords[1], "ã‚«ãƒ¼ãƒˆã«è¿½åŠ ãƒœã‚¿ãƒ³"):
            time.sleep(2)
            return True
        return False
    
    def go_to_cart(self):
        """ã‚«ãƒ¼ãƒˆãƒšãƒ¼ã‚¸ã¸ç§»å‹•"""
        print("\n=== ã‚«ãƒ¼ãƒˆãƒšãƒ¼ã‚¸ã¸ç§»å‹• ===")
        
        coords = self.coords['home']['cart_icon']
        if self.safe_click(coords[0], coords[1], "ã‚«ãƒ¼ãƒˆã‚¢ã‚¤ã‚³ãƒ³"):
            time.sleep(2)
            return True
        return False
    
    def proceed_to_checkout(self):
        """ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆã¸é€²ã‚€"""
        print("\n=== ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆã¸ ===")
        
        # ãƒšãƒ¼ã‚¸ä¸‹éƒ¨ã¸ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
        self.scroll_to_coordinate(800)
        
        coords = self.coords['cart']['checkout_button']
        if self.safe_click(coords[0], coords[1], "ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆãƒœã‚¿ãƒ³"):
            time.sleep(2)
            return True
        return False
    
    def fill_checkout_form(self, customer_info):
        """ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆãƒ•ã‚©ãƒ¼ãƒ ã‚’å…¥åŠ›"""
        print("\n=== ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆæƒ…å ±å…¥åŠ› ===")
        
        checkout_coords = self.coords['checkout']
        
        # å„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«å…¥åŠ›
        fields = [
            ('name_field', customer_info.get('name', ''), 'åå‰'),
            ('email_field', customer_info.get('email', ''), 'ãƒ¡ãƒ¼ãƒ«'),
            ('address_field', customer_info.get('address', ''), 'ä½æ‰€'),
            ('city_field', customer_info.get('city', ''), 'å¸‚åŒºç”ºæ‘'),
            ('zip_field', customer_info.get('zip', ''), 'éƒµä¾¿ç•ªå·'),
            ('phone_field', customer_info.get('phone', ''), 'é›»è©±ç•ªå·')
        ]
        
        for field_key, value, description in fields:
            coords = checkout_coords[field_key]
            self.type_text_at_coordinate(coords[0], coords[1], value, description)
            time.sleep(0.3)
        
        return True
    
    def select_payment_method(self, method='card'):
        """æ”¯æ‰•ã„æ–¹æ³•ã‚’é¸æŠ"""
        print(f"\n=== æ”¯æ‰•ã„æ–¹æ³•é¸æŠ: {method} ===")
        
        self.scroll_to_coordinate(600)
        
        method_map = {
            'card': 'payment_card',
            'paypal': 'payment_paypal'
        }
        
        method_key = method_map.get(method, 'payment_card')
        coords = self.coords['checkout'][method_key]
        
        if self.safe_click(coords[0], coords[1], f"æ”¯æ‰•ã„æ–¹æ³•: {method}"):
            time.sleep(1)
            return True
        return False
    
    def place_order(self, confirm=True):
        """æ³¨æ–‡ã‚’ç¢ºå®š"""
        if not confirm:
            print("æ³¨æ–‡ç¢ºå®šã¯ã‚¹ã‚­ãƒƒãƒ—ã•ã‚Œã¾ã—ãŸ")
            return False
        
        print("\n=== æ³¨æ–‡ç¢ºå®š ===")
        
        self.scroll_to_coordinate(850)
        
        coords = self.coords['checkout']['place_order']
        if self.safe_click(coords[0], coords[1], "æ³¨æ–‡ç¢ºå®šãƒœã‚¿ãƒ³"):
            time.sleep(3)
            print("âœ“ æ³¨æ–‡ãŒå®Œäº†ã—ã¾ã—ãŸï¼")
            return True
        return False
    
    def complete_purchase_flow(self, product_search, customer_info, payment_method='card', 
                               quantity=1, confirm_order=False):
        """
        å®Œå…¨ãªè³¼å…¥ãƒ•ãƒ­ãƒ¼
        
        Args:
            product_search: æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰
            customer_info: é¡§å®¢æƒ…å ±ã®è¾æ›¸
            payment_method: æ”¯æ‰•ã„æ–¹æ³•
            quantity: æ•°é‡
            confirm_order: å®Ÿéš›ã«æ³¨æ–‡ã‚’ç¢ºå®šã™ã‚‹ã‹ï¼ˆãƒ†ã‚¹ãƒˆæ™‚ã¯Falseæ¨å¥¨ï¼‰
        """
        print("\n" + "="*60)
        print("ğŸ›’ è‡ªå‹•è³¼å…¥ãƒ•ãƒ­ãƒ¼é–‹å§‹")
        print("="*60)
        
        try:
            # 1. ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ã¸
            self.navigate_to_home()
            
            # 2. å•†å“æ¤œç´¢
            if not self.search_product(product_search):
                raise Exception("å•†å“æ¤œç´¢ã«å¤±æ•—")
            
            # 3. å•†å“é¸æŠ
            if not self.select_product(position=1):
                raise Exception("å•†å“é¸æŠã«å¤±æ•—")
            
            # 4. ã‚«ãƒ¼ãƒˆã«è¿½åŠ 
            if not self.add_to_cart(quantity=quantity):
                raise Exception("ã‚«ãƒ¼ãƒˆè¿½åŠ ã«å¤±æ•—")
            
            # 5. ã‚«ãƒ¼ãƒˆãƒšãƒ¼ã‚¸ã¸
            if not self.go_to_cart():
                raise Exception("ã‚«ãƒ¼ãƒˆãƒšãƒ¼ã‚¸é·ç§»ã«å¤±æ•—")
            
            # 6. ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆã¸
            if not self.proceed_to_checkout():
                raise Exception("ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆé·ç§»ã«å¤±æ•—")
            
            # 7. ãƒ•ã‚©ãƒ¼ãƒ å…¥åŠ›
            if not self.fill_checkout_form(customer_info):
                raise Exception("ãƒ•ã‚©ãƒ¼ãƒ å…¥åŠ›ã«å¤±æ•—")
            
            # 8. æ”¯æ‰•ã„æ–¹æ³•é¸æŠ
            if not self.select_payment_method(payment_method):
                raise Exception("æ”¯æ‰•ã„æ–¹æ³•é¸æŠã«å¤±æ•—")
            
            # 9. æ³¨æ–‡ç¢ºå®š
            if not self.place_order(confirm=confirm_order):
                print("âš ï¸ æ³¨æ–‡ç¢ºå®šã¯ã‚¹ã‚­ãƒƒãƒ—ã•ã‚Œã¾ã—ãŸï¼ˆãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰ï¼‰")
            
            print("\n" + "="*60)
            print("âœ… è³¼å…¥ãƒ•ãƒ­ãƒ¼å®Œäº†")
            print("="*60)
            
            return True
            
        except Exception as e:
            print(f"\nâŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {e}")
            return False
    
    def cleanup(self):
        """ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—"""
        print("\nãƒ–ãƒ©ã‚¦ã‚¶ã‚’é–‰ã˜ã¾ã™...")
        time.sleep(2)
        self.driver.quit()


# ===== å®Ÿè¡Œä¾‹ =====
if __name__ == "__main__":
    
    # ECã‚µã‚¤ãƒˆè‡ªå‹•åŒ–ã‚’åˆæœŸåŒ–
    bot = EcommerceAutomation(
        base_url="https://example-shop.com",
        coordinates_file="ecommerce_coords.json"
    )
    
    # é¡§å®¢æƒ…å ±
    customer_data = {
        'name': 'å±±ç”°å¤ªéƒ',
        'email': 'taro.yamada@example.com',
        'address': 'æ±äº¬éƒ½æ¸‹è°·åŒº1-2-3',
        'city': 'æ¸‹è°·åŒº',
        'zip': '150-0001',
        'phone': '090-1234-5678'
    }
    
    try:
        # å®Œå…¨ãªè³¼å…¥ãƒ•ãƒ­ãƒ¼ã‚’å®Ÿè¡Œ
        success = bot.complete_purchase_flow(
            product_search="ãƒ¯ã‚¤ãƒ¤ãƒ¬ã‚¹ã‚¤ãƒ¤ãƒ›ãƒ³",
            customer_info=customer_data,
            payment_method='card',
            quantity=2,
            confirm_order=False  # ãƒ†ã‚¹ãƒˆã®ãŸã‚æ³¨æ–‡ç¢ºå®šã¯ã—ãªã„
        )
        
        if success:
            print("\nâœ… ã™ã¹ã¦ã®æ“ä½œãŒæ­£å¸¸ã«å®Œäº†ã—ã¾ã—ãŸ")
        else:
            print("\nâŒ ä¸€éƒ¨ã®æ“ä½œãŒå¤±æ•—ã—ã¾ã—ãŸ")
        
        # çµæœç¢ºèªã®ãŸã‚å°‘ã—å¾…æ©Ÿ
        input("\nEnterã‚­ãƒ¼ã‚’æŠ¼ã—ã¦ãƒ–ãƒ©ã‚¦ã‚¶ã‚’é–‰ã˜ã¾ã™...")
        
    finally:
        bot.cleanup()
```

---

## ğŸ“š åº§æ¨™ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¾‹

### ecommerce_coords.json

```json
{
  "home": {
    "search_box": [800, 100],
    "cart_icon": [1800, 80],
    "menu_button": [50, 80],
    "logo": [150, 80],
    "user_menu": [1700, 80]
  },
  "product_list": {
    "first_product": [300, 400],
    "second_product": [700, 400],
    "third_product": [1100, 400],
    "fourth_product": [1500, 400],
    "filter_button": [100, 300],
    "sort_dropdown": [1700, 250],
    "view_grid": [1600, 250],
    "view_list": [1650, 250],
    "page_2": [1000, 950],
    "page_3": [1050, 950]
  },
  "product_detail": {
    "add_to_cart": [1400, 650],
    "buy_now": [1400, 700],
    "quantity_plus": [1250, 550],
    "quantity_minus": [1150, 550],
    "size_selector": [1200, 450],
    "color_selector": [1200, 500],
    "wishlist_button": [1600, 350],
    "share_button": [1650, 350],
    "reviews_tab": [600, 850],
    "description_tab": [400, 850],
    "specifications_tab": [800, 850]
  },
  "cart": {
    "checkout_button": [1500, 900],
    "continue_shopping": [400, 900],
    "remove_item": [1700, 400],
    "update_quantity": [1600, 450],
    "coupon_field": [800, 700],
    "apply_coupon": [1000, 700],
    "estimate_shipping": [800, 750]
  },
  "checkout": {
    "name_field": [600, 300],
    "email_field": [600, 350],
    "address_field": [600, 400],
    "address2_field": [600, 450],
    "city_field": [600, 500],
    "state_field": [600, 550],
    "zip_field": [600, 600],
    "phone_field": [600, 650],
    "payment_card": [500, 750],
    "payment_paypal": [700, 750],
    "payment_bank": [900, 750],
    "place_order": [800, 950],
    "back_to_cart": [400, 950]
  }
}
```

---

## ğŸ¯ æœ€å¾Œã«ï¼šåº§æ¨™æŒ‡å®šã‚’ä½¿ã†ã¹ãå ´é¢

### âœ… åº§æ¨™æŒ‡å®šãŒé©ã—ã¦ã„ã‚‹å ´åˆ

1. **Canvas/SVGã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³**
   - ã‚²ãƒ¼ãƒ ã€æç”»ãƒ„ãƒ¼ãƒ«ã€ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ã‚°ãƒ©ãƒ•

2. **Shadow DOM**
   - Webã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…ã®è¦ç´ 

3. **å‹•çš„ID/ã‚¯ãƒ©ã‚¹**
   - ãƒ©ãƒ³ãƒ€ãƒ ã«ç”Ÿæˆã•ã‚Œã‚‹ID/ã‚¯ãƒ©ã‚¹å

4. **iframeå†…ã®è¤‡é›‘ãªæ§‹é€ **
   - ã‚»ãƒ¬ã‚¯ã‚¿ã§ã¯å–å¾—å›°é›£ãªè¦ç´ 

5. **ç”»åƒãƒ™ãƒ¼ã‚¹ã®UI**
   - ç”»åƒèªè­˜ã¨çµ„ã¿åˆã‚ã›ã¦ä½¿ç”¨

### âŒ åº§æ¨™æŒ‡å®šã‚’é¿ã‘ã‚‹ã¹ãå ´åˆ

1. **é€šå¸¸ã®HTMLè¦ç´ **
   - ã‚»ãƒ¬ã‚¯ã‚¿ã§å–å¾—å¯èƒ½ãªå ´åˆ

2. **ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³**
   - ç”»é¢ã‚µã‚¤ã‚ºã§è¦ç´ ä½ç½®ãŒå¤‰ã‚ã‚‹

3. **é »ç¹ã«æ›´æ–°ã•ã‚Œã‚‹UI**
   - ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãŒå¤‰æ›´ã•ã‚Œã‚„ã™ã„

4. **æœ¬ç•ªç’°å¢ƒ**
   - ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ€§ãŒä½ã„

---

## ğŸš€ ã¾ã¨ã‚

åº§æ¨™æŒ‡å®šã¯**æœ€å¾Œã®æ‰‹æ®µ**ã§ã™ãŒã€é©åˆ‡ã«ä½¿ãˆã°å¼·åŠ›ãªãƒ„ãƒ¼ãƒ«ã§ã™ï¼

### é‡è¦ãƒã‚¤ãƒ³ãƒˆ
1. **ã‚»ãƒ¬ã‚¯ã‚¿å„ªå…ˆ** - å¯èƒ½ãªé™ã‚ŠID/XPath/CSSã‚»ãƒ¬ã‚¯ã‚¿ã‚’ä½¿ã†
2. **åº§æ¨™è£œæ­£** - ç”»é¢ã‚µã‚¤ã‚ºã«å¿œã˜ã¦èª¿æ•´
3. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°** - ãƒªãƒˆãƒ©ã‚¤å‡¦ç†ã‚’å¿…ãšå®Ÿè£…
4. **ãƒ‡ãƒãƒƒã‚°** - ãƒãƒ¼ã‚«ãƒ¼è¡¨ç¤ºã§è¦–è¦šçš„ã«ç¢ºèª
5. **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆåŒ–** - åº§æ¨™ã®æ„å‘³ã‚’ã‚³ãƒ¡ãƒ³ãƒˆã§æ®‹ã™

ã“ã‚Œã§åº§æ¨™æŒ‡å®šã®å®Œå…¨ãƒã‚¹ã‚¿ãƒ¼ã§ã™ï¼ğŸ‰


